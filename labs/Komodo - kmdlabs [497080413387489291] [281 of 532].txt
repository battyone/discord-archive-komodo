==============================================================
Guild: Komodo
Channel: kmdlabs
Topic: Please read pinned messages
Messages: 100
Range: 
==============================================================

[07-Feb-19 01:38 PM] blackjok3r#3181
@ComputerGenie 👴🏼📢  Thats a good thing I think.... you didnt fork it 😂

[07-Feb-19 01:39 PM] ComputerGenie 👴🏼📢#7004
I know, I just couldn't help throwing it out there 😛

[07-Feb-19 01:40 PM] blackjok3r#3181
btw this is using the exact thing you have alwyas requested

[07-Feb-19 01:40 PM] blackjok3r#3181
PoS get exponentially harder if it goes over its %

[07-Feb-19 01:41 PM] blackjok3r#3181
and it get a littl easier capped block times) if its under, but not an exponeltial increase ...

[07-Feb-19 01:41 PM] smk762 -  dracocanis ominator#7640
```
-ASSET-          -BALANCE-  -UTXO-  -NOTR-  -BLOX-   -PCT-  -LAST-  -CNCT-
KMD               100.8282      26         1218334              1m      33
LABST2            788.7428      17      72    1555    4.6%      1m       8
LABST5              2.0238      15       5     133    3.8%      1m       2
```
just 2 and 5 now?

[07-Feb-19 01:42 PM] blackjok3r#3181
yep ... I dont really ahve resources to launch more than one chain. I will launch another tomorrow if this one preves to work.

{Reactions}
👍 

[07-Feb-19 01:42 PM] ComputerGenie 👴🏼📢#7004
`PoS get exponentially harder if it goes over its %`
is that also offset by block times? We don't want a chain to have the opposite issue where it **must** be hit with PoW to keep going

[07-Feb-19 01:42 PM] blackjok3r#3181
With verushash thats a non issue

[07-Feb-19 01:42 PM] ComputerGenie 👴🏼📢#7004
k

[07-Feb-19 01:43 PM] blackjok3r#3181
1 core porvides enough hash rate to keep it moving unless 1000 ppl mine a 0 BR chaina t once thjen all stop

[07-Feb-19 01:43 PM] blackjok3r#3181
I can see maybe a chain with full blocks of txns atracting hash rate. but thats is about it

[07-Feb-19 01:44 PM] blackjok3r#3181
Fromn early testing, the PoS diff adjustment doesnt really kick in at all... unless there are simply no utxos elegible... then after 4-5mins a block will happen proveided htere is a single utxo on chain that is elegible

{Reactions}
shexy 

[07-Feb-19 01:44 PM] blackjok3r#3181
which is exactly what we wanted for 0BR chains....

[07-Feb-19 01:45 PM] blackjok3r#3181
We are really lucky verushhash 1.1 existed for us to use so easily

[07-Feb-19 01:45 PM] blackjok3r#3181
in the scheme of things the week or so of time it took to get working wasnt that bad... compared to having to ake our own lol

[07-Feb-19 01:46 PM] ComputerGenie 👴🏼📢#7004
I never did get to run valgrind on iguana yet, but fwiw KMD chain is using less ram with these last 3-4 builds

[07-Feb-19 01:47 PM] blackjok3r#3181
hmm thats cool I dint change a lot that I know of... maybe unintended concequences ... iguana is the real problem.. many ppl will be happy if we can nail that down

[07-Feb-19 01:48 PM] ComputerGenie 👴🏼📢#7004
agreed about iguana, but just thought I'd let you know what I saw with that bit

{Reactions}
👍 

[07-Feb-19 01:48 PM] blackjok3r#3181
10GB of ram use for a tiny C program that start soff usig 500mb is a bit ridicuous

{Reactions}
👆🏽 

[07-Feb-19 01:49 PM] jl777c#5810
had a 64GB budget

[07-Feb-19 01:49 PM] ComputerGenie 👴🏼📢#7004
@smk762 -  dracocanis ominator I've spent years trying to figure out how people watch AJ other than for comedic effect

[07-Feb-19 01:52 PM] blackjok3r#3181
@jl777c  I got a 128GB server... its no problem.. but is is for LABS.... we use very small VPS

[07-Feb-19 01:54 PM] jl777c#5810
there is a garbage collector in the code that launches a new process

[07-Feb-19 01:54 PM] ComputerGenie 👴🏼📢#7004
`we use very small VPS`
So, use a bigger one :troll:

[07-Feb-19 01:54 PM] jl777c#5810
you can tighten the blocks before it frees, i think it is set to 100 or something big

[07-Feb-19 01:54 PM] jl777c#5810
and really after 10 it isnt needed

[07-Feb-19 01:54 PM] jl777c#5810
that might reduce usage 10x

{Reactions}
shexy 

[07-Feb-19 01:54 PM] smk762 -  dracocanis ominator#7640
AJ is a funnier comedian than JR

{Reactions}
😂 

[07-Feb-19 01:55 PM] ComputerGenie 👴🏼📢#7004
JR stopped being funny (outside of his knack to deal with *some* hecklers) 2 decades ago

[07-Feb-19 02:30 PM] blackjok3r#3181
this is quite hilarious

[07-Feb-19 02:57 PM] blackjok3r#3181
well so far everything looks to be working smoothly.... buty I am yet to see any prints of where the new code I wrote today is being activated 😦

[07-Feb-19 05:58 PM] blackjok3r#3181
its still working here? everone else?

[07-Feb-19 06:09 PM] ComputerGenie 👴🏼📢#7004
so far all's good here, but I haven't done anything but sync and mine yet

[07-Feb-19 06:10 PM] ComputerGenie 👴🏼📢#7004
QT is kicking my ass

[07-Feb-19 06:37 PM] blackjok3r#3181
seems solid... how do we break it?

[07-Feb-19 06:53 PM] blackjok3r#3181
🕺

[07-Feb-19 07:28 PM] zatJUM#9924
Seems good for me too 😃 ```LABST5              2.0081     194       6     533    1.1%     12m       5```

[07-Feb-19 07:44 PM] blackjok3r#3181
I cant belive it works 😂

[07-Feb-19 08:32 PM] Bar_F1sh_Rel#0834
Lol migrating is really difficult when blocks stop moving.

[07-Feb-19 08:49 PM] ComputerGenie 👴🏼📢#7004
`I cant belive it works`
because it doesn't :troll:

[07-Feb-19 08:49 PM] ComputerGenie 👴🏼📢#7004
```2019-02-07 20:48:54 Running KomodoMiner.tromp with 7 transactions in block (3578 bytes)
2019-02-07 20:48:54 Block 1978 : PoS 81% vs target 51% 
2019-02-07 20:48:54 connect() to [2607:5300:120:f31::]:56534 failed after select(): Network is unreachable (101)
2019-02-07 20:49:10 ERROR: ConnectBlock(): Notarisation is not in TX position 1! Invalid Block!
```

[07-Feb-19 08:50 PM] ComputerGenie 👴🏼📢#7004
```>>>>>>VALID NOTARIZATION ht.1975
Notarisation b0f623c7c87ed6a04afca4b2ac89b6990a6156599087c9e18a4ec67cfcccdb22 set to maximum priority
>>>>>>VALID NOTARIZATION ht.1975
Notarisation f8fbb82f756f30cc2e4a843f6f8e30333ea3549e5f7650247f8d3c97d2d38bfe set to maximum priority replacing notarization d00b1a4be0dc668ea83cfa72d97ac8a9cde0207b330974633b5e3c4c05064f0a
>>>>>MINER NotarisationNotaries.4
>>>>>>VALID NOTARIZATION ht.1975
blocks since last notarization: 5
payment per notary.375000000
Created notary payment coinbase totalsat.1500000000```

[07-Feb-19 08:50 PM] ComputerGenie 👴🏼📢#7004
repeated over and over

[07-Feb-19 10:12 PM] ComputerGenie 👴🏼📢#7004
restart of mining node "fixed" whatever caused that

[08-Feb-19 03:33 AM] smk762 -  dracocanis ominator#7640
` [LABST2] Synced to 522, but no longest chain is found. FEK it, Starting anyway.`

{Reactions}
troll_hardcore 

[08-Feb-19 04:20 AM] Alright#0419
heh

[08-Feb-19 05:47 AM] blackjok3r#3181
it was a bug. pushed fix

[08-Feb-19 05:48 AM] blackjok3r#3181
Had to just wait until that code activated had no idea if it would work of not

[08-Feb-19 05:49 AM] blackjok3r#3181
It wasnt pulling the first ntoarisation off the vertor... and was adding 2... Also had something wird on 5, where it was saying that 2 notarisations were for the same block height... I didnt think that was possible but apparently it is... so I just made it skip the second if that happens again...

[08-Feb-19 06:15 AM] blackjok3r#3181
Fix seems to be working here.

[08-Feb-19 06:15 AM] blackjok3r#3181
only affects people mining...

[08-Feb-19 06:52 AM] Bar_F1sh_Rel#0834
Unexpected reboot of server a few hours ago - LABST5 went to reindex and hung at 82 and 356 blocks respectively (different nodes).
Took removing the whole T5 directory to get a sync.

[08-Feb-19 06:55 AM] blackjok3r#3181
it was shut down correctly or ahrd reset?

[08-Feb-19 06:56 AM] Bar_F1sh_Rel#0834
Power outage

[08-Feb-19 06:56 AM] blackjok3r#3181
Somehwere along the ling in KMD the FlushDatabaseToDisk function was removed... so if it doesnt actually shuit down then it doesnt flush the DB to disk.... and it needs to reindex

[08-Feb-19 06:57 AM] blackjok3r#3181
and tbh... not sure if reindex can work with these chains

[08-Feb-19 06:57 AM] blackjok3r#3181
it would need to clear the komodostate file before doign a reindex 🤔

[08-Feb-19 06:57 AM] blackjok3r#3181
Thanks... thats a bug I need to fix 😂

[08-Feb-19 06:58 AM] blackjok3r#3181
should be easy enough to reproduce... sync chain power off VM

[08-Feb-19 06:58 AM] blackjok3r#3181
😃 thanks

[08-Feb-19 06:58 AM] Bar_F1sh_Rel#0834
Lol - Happy to help 😃

[08-Feb-19 06:59 AM] blackjok3r#3181
height acticvation for ac_notarypay (start and stop height) I think is another thing still to add... Shouldnt be too hard..

[08-Feb-19 07:00 AM] blackjok3r#3181
If anyone has any ideas on how we can extend ac_notarypay if someone was to pay for it let me know... That would be a really nice thing to have.

[08-Feb-19 07:00 AM] Bar_F1sh_Rel#0834
whats current chain length on 2&5?

[08-Feb-19 07:14 AM] blackjok3r#3181
1238 for 5 
and 2546 for 2 here

[08-Feb-19 07:14 AM] Bar_F1sh_Rel#0834
@blackjok3r - OK - I can't get back to length on T2 - stuck at 2127

[08-Feb-19 07:15 AM] blackjok3r#3181
ok will try fresh sync here and see

[08-Feb-19 07:15 AM] Bar_F1sh_Rel#0834
and odly - I am a block behind on T5

[08-Feb-19 07:26 AM] Bar_F1sh_Rel#0834
might be: ```2019-02-08 07:12:10 ERROR: ConnectBlock(): Notaries have not been paid!
2019-02-08 07:12:10 Misbehaving: 51.38.82.189:56534 (0 -> 100)
2019-02-08 07:12:10 InvalidChainFound: invalid block=0b238f8ae56b3e4298bd5603ccc0a5a0f9d9bc4a8d69bf1e784de9d41c6e6659  height=2128  log2_work=25.788736  log2_stake=-inf  date=2019-02-08 00:10:34
2019-02-08 07:12:10 InvalidChainFound:  current best=040e0d17ee19aa50339368010cd2cdf88f43766fd85ee9f0dc4088a384d2199a  height=2127  log2_work=25.78682  log2_stake=-inf  date=2019-02-08 00:04:01
2019-02-08 07:12:10 ERROR: ConnectTip(): ConnectBlock 0b238f8ae56b3e4298bd5603ccc0a5a0f9d9bc4a8d69bf1e784de9d41c6e6659 failed
2019-02-08 07:12:10 InvalidChainFound: invalid block=0b238f8ae56b3e4298bd5603ccc0a5a0f9d9bc4a8d69bf1e784de9d41c6e6659  height=2128  log2_work=25.788736  log2_stake=-inf  date=2019-02-08 00:10:34
2019-02-08 07:12:10 InvalidChainFound:  current best=040e0d17ee19aa50339368010cd2cdf88f43766fd85ee9f0dc4088a384d2199a  height=2127  log2_work=25.78682  log2_stake=-inf  date=2019-02-08 00:04:01
2019-02-08 07:12:10 ERROR: AcceptToMemoryPool: tx inputs not found
2019-02-08 07:12:32 connect() to 195.201.137.5:56534 failed after select(): Connection refused (111)```

[08-Feb-19 07:29 AM] blackjok3r#3181
hmm strange. wil check it out thanks

[08-Feb-19 07:29 AM] blackjok3r#3181
not being able to sync is very bad lol

[08-Feb-19 07:30 AM] blackjok3r#3181
its werid... I think like the only thing we can do to prevent this, I think is to insert a dummy tx as tx1 in a block, if the notartisation is deemed invalid ... but that seems like a stupid way to do it tbh... I think it would work... anyway I'll look into it. Thanks 😃

[08-Feb-19 07:39 AM] blackjok3r#3181
🤔 maybe its connecting block in teh wrong order... I think it can do that on initial sync

[08-Feb-19 07:42 AM] blackjok3r#3181
Yeah it stopped at the same block here...

[08-Feb-19 08:06 AM] blackjok3r#3181
What happens to stop it syncing right....
But it may mean thse chains we have now are unable to sync... I think its a slight consensus rule to fix it
What happens is:
1) notatisation happens and is marked as notarised
2) block is reorged and the coinbase is therefore removed from the chain
3) next block comes in with that notrisation tx again, its flagged as invalid, becasue the checkpoint already exists. (you cant undo a notarization)
So when you fresh sync it... the first time it sees the notarization it expects the coinbase to be there but its isnt
I think it just means when it needs to do the check for valid or invalid... it needs to return valid if the height is `>=` rather than just` >`
doent cahnge how the dPoW works... just the code that checks if a notarisation is valid or not to create coinbase

[08-Feb-19 08:14 AM] blackjok3r#3181
Computer froze not staking either chain, they may stop for a while. Will try my fix soon, doubtful it will fix the ST2 syncing may need to start a new chain.. 😦

[08-Feb-19 08:14 AM] blackjok3r#3181
or add an expetion fo that block 🤔

[08-Feb-19 10:04 AM] ComputerGenie 👴🏼📢#7004
```2019-02-08 07:09:04 proof-of-work found  
  hash: 000000002d344aa02e6e1cf8a83c0867f3643de7583f832c37e1ad2b51b68b80  
target: 000000002e5171d80b3f06aada211d97db6439f02476d11a4867a67d9f71ad2e
2019-02-08 07:09:04 CBlock(hash=000000002d344aa02e6e1cf8a83c0867f3643de7583f832c37e1ad2b51b68b80, ver=4, hashPrevBlock=000000000908f875f950a2b1e5712c5f69bb123df518e184da8bd6280fd4fd99, hashMerkleRoot=f46921d910fcd61d362287a7c073587b0433dc6cf05437adb02403234a78e636, hashFinalSaplingRoot=3e49b5f954aa9d3545bc6c37744661eea48d7c34e3000d82b7f0010c30f4c2fb, nTime=1549609738, nBits=1d036558, nNonce=0000c5f25bcf1943830a506052bacf7e42af22909695c69f5237fd5ec0dfcffe, vtx=2)
  CTransaction(hash=64b72201e1, ver=4, fOverwintered=1, nVersionGroupId=892f2085, vin.size=1, vout.size=1, nLockTime=1549609738, nExpiryHeight=0, valueBalance=0, vShieldedSpend.size=0, vShieldedOutput.size=0)
    CTxIn(COutPoint(0000000000, 4294967295), coinbase 02d004011f)
    CTxOut(nValue=0.00010000, scriptPubKey=2102e1796bafba422c7b87feb6d778)```

[08-Feb-19 10:05 AM] ComputerGenie 👴🏼📢#7004
```  CTransaction(hash=d986897b68, ver=4, fOverwintered=1, nVersionGroupId=892f2085, vin.size=4, vout.size=2, nLockTime=0, nExpiryHeight=0, valueBalance=0, vShieldedSpend.size=0, vShieldedOutput.size=0)
    CTxIn(COutPoint(8f23bc6d61, 4), scriptSig=473044022057c410c61ad6c4)
    CTxIn(COutPoint(5f2ec7d90e, 7), scriptSig=483045022100afd30cafa448)
    CTxIn(COutPoint(f6b0bf3ef8, 2), scriptSig=4730440220602e93221df085)
    CTxIn(COutPoint(8b40154232, 116), scriptSig=483045022100ac9903703568)
    CTxOut(nValue=0.00030000, scriptPubKey=21020e46e79a2a8d12b9b5d12c7a91)
    CTxOut(nValue=0.00000000, scriptPubKey=6a4c931f22e34c8209473f687e952d)

  vMerkleTree:  64b72201e1fe029b9fa083f7baf184ff95c3e1c29338833a16c915376fe3f051 d986897b683d59acc59a3ac43788e288f79fc29cf1a3112b172bcd9dd79e9381 f46921d910fcd61d362287a7c073587b0433dc6cf05437adb02403234a78e636

2019-02-08 07:09:04 generated 0.0001 height.1232
2019-02-08 07:09:04 keypool keep 522
2019-02-08 07:09:04 ConnectBlock: wrote 1 block notarisations in block: 000000002d344aa02e6e1cf8a83c0867f3643de7583f832c37e1ad2b51b68b80
2019-02-08 07:09:04 UpdateTip: new best=000000002d344aa02e6e1cf8a83c0867f3643de7583f832c37e1ad2b51b68b80  height=1232  log2_work=40.194378  log2_stake=-inf  tx=1713  date=2019-02-08 07:08:58 progress=1.000000  cache=0.5MiB(1644tx)
2019-02-08 07:09:04 AddToWallet 64b72201e1fe029b9fa083f7baf184ff95c3e1c29338833a16c915376fe3f051  new
```

[08-Feb-19 10:05 AM] ComputerGenie 👴🏼📢#7004
any idea why that would cause a disconnecting fork?

[08-Feb-19 10:06 AM] ComputerGenie 👴🏼📢#7004
```Found block 1232 
mining reward 0.00010000 LABST5!
  hash: 000000002d344aa02e6e1cf8a83c0867f3643de7583f832c37e1ad2b51b68b80  
target: 000000002e5171d80b3f06aada211d97db6439f02476d11a4867a67d9f71ad2e

[LABST5] ht.1232 txi.1 signedmask.1281 numvins.4 numvouts.2 <<<<<<<<<<<  notarized
[LABST5] matched.1 VALID (LABST5) MoM.ae8a99e4d64574c85d30d5107f583f73fa6245ff62b3d695deb2cc7946866532 [5] CCid.667
Block 1232 added to chain
no nodes, attempting reconnect
no nodes, attempting reconnect
no nodes, attempting reconnect
no nodes, attempting reconnect```

[08-Feb-19 10:15 AM] blackjok3r#3181
probably the same bugf as above

[08-Feb-19 10:15 AM] blackjok3r#3181
If you dont see the reorged block

[08-Feb-19 10:15 AM] blackjok3r#3181
then you dont agree weather a notarization is valid with the nodes who saw that block

[08-Feb-19 10:16 AM] blackjok3r#3181
I have an idea of how to fix it but im not sure how viable it is

[08-Feb-19 10:16 AM] blackjok3r#3181
struggling to think straight ewnough to wrap my head around it

[08-Feb-19 10:17 AM] blackjok3r#3181
The other option Alright came up with is to pay for ntoarisations that happened 10 blocks ago.. but i really dont liek that solution, its seems VERY hard to code.

[08-Feb-19 10:19 AM] blackjok3r#3181
I have like an A4 page of text descibing the problem if you want to read it... but I'm not sure you need to lol...

[08-Feb-19 10:19 AM] Bar_F1sh_Rel#0834
😂

[08-Feb-19 10:21 AM] ComputerGenie 👴🏼📢#7004
Did you write your name lengthwise or just a new line for each letter? :troll_king:

{Reactions}
troll_cool 

[08-Feb-19 10:25 AM] blackjok3r#3181
How ac_notarypay works

notaries create a notarization
propagates to mempool
nodes when scanning their mempool, first check each tx is to the crypto address
when it finds a tx to the crypto address it then checks the vins are from current set of notary nodes.
If it finds a tx with enough vins from notary node pubkeys, it then checks if each vin is unique. If all vins are from diffrent notaries
it then checks if the notarization is valid. 
If the notarization is a valid checkpoint, it then saves the notary ids.
If it sees another notarization in the mempool after this, it checks if the notarized height is higher/lower. 
It does this to force the earliest check point though first, to prevent them being confirmed out of order, at least as much as possible.
This cant guarentee that all notarisations are confirmed in order, but it will get close, unless blocktimes are extremly fast.
Then it sets the notrization it has chosen as the highest priority and every tx that is also the highest priority priotity -10, forcing the notarization into tx position 1. Which later on is a consensus rule in ConnectBlock.

Then it uses this information it has gathered to constuct a coinbase that pays each notaryid it has saved. All this is also enforced by a consenus check. The consensus check, gets the notarization, and preforms the same operation as the miner, and then matches the coinbase pubkeys and amounts.

[08-Feb-19 10:25 AM] blackjok3r#3181
The problem that is causing ST2 to get stuck on block 2128 is there is a valid checkpoint in tx position 1, and he coinbase does not pay the notary nodes. 

This can happen by the following sequence of events:
    Notarisation is valid, and included in a block.
    this block propagates to other nodes and the notarisation is added to the checkpoint data
    The checkpoint cant be undone incase of a reorg, for obvious reasons.
    The tx/block the notarizion is in, can be reorged until the next notarisation happens
    So the miner when creating the block with the tx in it the second time
    does its check to see if the notarization is valid, returns false... because this checkpoint already exists.
    It then goes ahead and makes the block with a normal coinbase assuming the notarisation is invalid, and all other nodes will also see it as invalid.
    This isnt a problem for nodes who all saw the reorged block, as they also see it as invalid.
    When you try to sync from scratch though, you dont ever get the reorged block, so your node sees the notarization as valid, and the coinbase isnt paid out, flaging the block as invalid.

[08-Feb-19 10:26 AM] ComputerGenie 👴🏼📢#7004
The main problem is recovery from if/when it happens
I can't even reconsider or invalidate my way back, so it takes a resync

[08-Feb-19 10:26 AM] blackjok3r#3181
yes it requires a resync which at tghe moment is form nodes who have an invalid block in their chain

[08-Feb-19 10:27 AM] blackjok3r#3181
so it doesnt even sync./.. on ST2 that is

[08-Feb-19 10:28 AM] ComputerGenie 👴🏼📢#7004
I'm wondering if it's not related to the bit that causes the `ERROR: ConnectBlock(): coinbase pays too much (actual=398884 vs limit=10000)` that it sticks on afterwards when you try to roll back?

[08-Feb-19 10:28 AM] blackjok3r#3181
The exact problem is outlined in that wall of text above if you can understand it

[08-Feb-19 10:29 AM] blackjok3r#3181
The problem is a notarisation tx can be reorged... but a ntoarisation checkpoint cannot

[08-Feb-19 10:29 AM] blackjok3r#3181
so once a notarisation tx is pushed back to the mempool adn included in a new block


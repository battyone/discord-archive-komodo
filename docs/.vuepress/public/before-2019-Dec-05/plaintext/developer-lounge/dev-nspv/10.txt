==============================================================
Guild: Komodo
Channel: dev-nspv
Topic: ./komodod -nSPV=1 -ac_reward=100000000  -ac_name=NSPV -ac_supply=10000000000 -ac_cc=2 -addressindex=1 -spentindex=1 -connect=5.9.102.210 &
./komodod -nSPV=1 -addnode=5.9.253.195 &
https://drive.google.com/drive/folders/1ZvzrhNBQgroejTKPl0kCOTJ8h7XMnO2M?usp=sharing
Messages: 100
Range: before 05-Dec-19 12:00 AM
==============================================================

[06-Jul-19 08:24 PM] jl777c#5810
there are 11 nSPV fullnodes for ILN, theoretical capacity of almost 10,000 clients, assuming just one fullnode peer per nSPV client. the 873 limit is pretty hardcoded, wont be easy to update. just need more fullnodes

[06-Jul-19 08:28 PM] jl777c#5810
i guess spreading out the load with 873 nSPV clients for each fullnode, that shouldnt cause it that much load as most of the time the superlite clients will just be idle

[06-Jul-19 08:34 PM] SHossain#0007
all NN could be a full node perhaps?

[06-Jul-19 08:34 PM] SHossain#0007
we could get at least 100 nodes 😃

[06-Jul-19 08:36 PM] jl777c#5810
when nSPV is released, all fullnodes will be nSPV fullnodes, even without addressindex=1, they can provide most all the other info needed

[06-Jul-19 08:36 PM] SHossain#0007
nice

[06-Jul-19 08:36 PM] jl777c#5810
only nspv_listunspent needs addressindex=1

[06-Jul-19 08:37 PM] jl777c#5810
and that can be mostly cached client side

[06-Jul-19 08:42 PM] allbits#5898
So I rebuilt, logged in fine. Attempted to send but I put an amount that was too high. Then after that I could not make any other calls: "couldn't connect to server". Looked at original terminal and I see "Assertion 'fvalid' failed.

[06-Jul-19 08:44 PM] allbits#5898
When I put in the too high amount it did respond with the appropriate message of "not enough funds"

[06-Jul-19 08:45 PM] allbits#5898
After that I tried to spend the proper amount (without logging in again) and it returned the message "couldn't connect to server: EOF reached (code 1)"

[06-Jul-19 08:48 PM] jl777c#5810
couldn't connect to server

[06-Jul-19 08:48 PM] jl777c#5810
that means it crashed

[06-Jul-19 08:49 PM] jl777c#5810
do you have the latest version?

[06-Jul-19 08:49 PM] allbits#5898
I pulled about an hour ago

[06-Jul-19 08:50 PM] jl777c#5810
pull again, i added more error checking for expired wif about an hour ago

[06-Jul-19 08:50 PM] allbits#5898
Ok

[06-Jul-19 08:51 PM] jl777c#5810
if you did a login and waited a bit, then it could easily have gone past the old 60 second limit. i increased the login time to 777 seconds

[06-Jul-19 08:51 PM] jl777c#5810
and also check right before using the wif that it is still there

[06-Jul-19 08:52 PM] allbits#5898
How do I check if it's still there?

[06-Jul-19 08:52 PM] jl777c#5810
if what is still there? oh, the wif... i will add it to getinfo

[06-Jul-19 08:52 PM] allbits#5898
K

[06-Jul-19 08:58 PM] allbits#5898
Ok. Updated, repeated same work flow and everything worked as expected

[06-Jul-19 08:58 PM] jl777c#5810
updated nspv_getinfo

[06-Jul-19 08:58 PM] jl777c#5810
it shows your address/pubkey and when wif expires

[06-Jul-19 09:01 PM] allbits#5898
Updating again. Loving the git pull; make

[06-Jul-19 09:02 PM] SHossain#0007
😃

[06-Jul-19 09:02 PM] SHossain#0007
live debugging

[06-Jul-19 09:03 PM] SHossain#0007
this only happens in Komodo Universe

[06-Jul-19 09:09 PM] allbits#5898
Ok. Updated. Logged in. nspv_getinfo shows address, pubkey and wifexpires!

[06-Jul-19 09:11 PM] allbits#5898
Also, getnewaddress works. Returns wif, address and pubkey. However, those aren't shown in nspv_getinfo

[06-Jul-19 09:24 PM] allbits#5898
After the wif expires, the expired address and pubkey are still returned by nspv_getinfo. The wifexpires is no longer returned.

[06-Jul-19 09:34 PM] SHossain#0007
does that show your WIF though?

[06-Jul-19 09:35 PM] SHossain#0007
you shouldn't be able to spend from that address after the WIF expires.

[06-Jul-19 09:35 PM] SHossain#0007
you need to login again usign the WIF

[06-Jul-19 09:36 PM] allbits#5898
Yes I understand. Just saying that the address and pubkey persist past expiry in the nspv_getinfo call. Maybe they shouldn't?

[06-Jul-19 09:37 PM] allbits#5898
And when getnewaddress is called, is there an expiry that's associated with that? And should the address that's generated by getnewaddress be returned in a nspv_getinfo call?

[06-Jul-19 09:41 PM] allbits#5898
Confirm that when I log in with an entirely new wif, nspv_getinfo returns the address and pocket for the new wif only

[06-Jul-19 10:08 PM] daemonfox#6136
sounds like the memcache is holding the 2 values but the code does wipe the WIF.

[06-Jul-19 10:09 PM] daemonfox#6136
Also, in theory this now works for every dPOW notarized coin within the Komodo ecosystem... can you activate nSPV atomic swaps?

[06-Jul-19 10:18 PM] daemonfox#6136
I mean that is supposed to be the idea right? Lite and easy enough that anyone with their WIF/Seed can open the Lite wallet, enter their key and issue many KMD commands not just sends and reads, but viewing, publishing and interacting with DEX offers, Voting, viewing a game or stream output live and  take tips/subs/donations

[07-Jul-19 12:44 AM] Alright#0419
Pinned a message.

[07-Jul-19 12:48 AM] allbits#5898
@Alright I launched the kmd nspv with a different addnode, as per jl777

[07-Jul-19 12:50 AM] allbits#5898
./komodod -nSPV=1 -addnode=23.254.165.16 &

[07-Jul-19 12:51 AM] Alright#0419
hey thanks, was scrolling endlessly looking for that

{Reactions}
👍 

[07-Jul-19 05:03 AM] TonyL#3577
`@TonyL, i think i boosted the max possible connections to 8000` @jl777c max possible clients amount of client connections to single server? 
Can see `nMaxConnections 873` print on daemon init atm

[07-Jul-19 05:13 AM] TonyL#3577
yep, still 873 😃

[07-Jul-19 05:41 AM] jl777c#5810
yes it is a hardcoded limit on unix as the select call only handles up to 1024 and there are some slots reserved

[07-Jul-19 05:41 AM] jl777c#5810
@allbits getnewaddress just generates a random new address

[07-Jul-19 05:42 AM] jl777c#5810
doesnt store it anyway, doesnt login, though maybe i should make it automatically login

[07-Jul-19 05:42 AM] jl777c#5810
the getinfo shows the most recent login info

[07-Jul-19 05:42 AM] jl777c#5810
my idea is that unless you specifically login, there is no indication you are actually using a privkey

[07-Jul-19 05:43 AM] jl777c#5810
so getinfo just ignores anything getnewaddress does, that is just to generate a new address now, nothing to do with login

[07-Jul-19 06:30 AM] TonyL#3577
maybe add `nspv_logout` call which will immideatly flush wif from memory? (this way apps will be able to control for how long keep wif)

[07-Jul-19 06:37 AM] TonyL#3577
```scrub wif and privkey from NSPV memory
./komodo-cli -ac_name=ILN nspv_getinfo
{
  "result": "success",
  "address": "RMjy5VkHFJkXTJDTJ3XX1zVzukP48sKyva",
```

[07-Jul-19 06:37 AM] TonyL#3577
after 777 seconds getinfo not showing `wifexpires` anymore but still can see address

[07-Jul-19 06:37 AM] jl777c#5810
yes, that is by design

[07-Jul-19 06:38 AM] jl777c#5810
it shows last address used

{Reactions}
👌 

[07-Jul-19 06:38 AM] TonyL#3577
and listunspent with any argument returns  unspent for`  "address": "RMjy5VkHFJkXTJDTJ3XX1zVzukP48sKyva",`

[07-Jul-19 06:38 AM] TonyL#3577
```./komodo-cli -ac_name=ILN nspv_listunspent RQ1mvCUcziWzRwE8Ugtex29VjoFjRzxQJT
...
  "address": "RMjy5VkHFJkXTJDTJ3XX1zVzukP48sKyva",
  "height": 2694,
  "numutxos": 6,
  "balance": 23.3097
}```

[07-Jul-19 06:38 AM] jl777c#5810
that is not right, it should only be if there is no argument for listunspent

[07-Jul-19 06:38 AM] jl777c#5810
fixing

[07-Jul-19 06:39 AM] TonyL#3577
almost finished with unittest 😃

[07-Jul-19 06:42 AM] jl777c#5810
i added nspv_logout, fixed listunspent. the idea of the address staying around is for things like listunspent without arg defaulting to the last address

[07-Jul-19 06:43 AM] jl777c#5810
the model is user has single address, though with the speed there is no such restriction

[07-Jul-19 06:43 AM] jl777c#5810
keeping the wif active just seems dangerous

[07-Jul-19 06:43 AM] jl777c#5810
autologout will prevent access to funds on a node that was logged into and forgotten about

[07-Jul-19 06:44 AM] jl777c#5810
if you want to keep it alive, just login on a timer. there is no harm to login again

[07-Jul-19 06:44 AM] jl777c#5810
it works more with a dead man switch type of logic

[07-Jul-19 06:45 AM] TonyL#3577
I think best way from app side is like a: login -> needed operations -> logout

[07-Jul-19 06:46 AM] TonyL#3577
rebuilding

[07-Jul-19 06:46 AM] jl777c#5810
you have 777 seconds to complete  "needed operations"

[07-Jul-19 06:46 AM] jl777c#5810
if not done, do a login again

[07-Jul-19 06:47 AM] TonyL#3577
just thought that 777 seconds might be unsafe for mobile devices lets say - you can go toilet let say

[07-Jul-19 06:47 AM] TonyL#3577
back and money gone

[07-Jul-19 06:47 AM] TonyL#3577
😃

[07-Jul-19 06:47 AM] jl777c#5810
you can logout anytime before 777 seconds

{Reactions}
😂 

[07-Jul-19 06:47 AM] TonyL#3577
yeah, now I can 🙌

[07-Jul-19 06:47 AM] jl777c#5810
fixed syntax error

[07-Jul-19 06:50 AM] TonyL#3577
hmm nspv_listunspent after logout working same way as before for me

[07-Jul-19 06:51 AM] TonyL#3577
`./komodo-cli -ac_name=ILN nspv_listunspent RQ1mvCUcziWzRwE8Ugtex29VjoFjRzxQJT` using another address as arg but getting listunspent for address for which I was logged in
```  "address": "RMjy5VkHFJkXTJDTJ3XX1zVzukP48sKyva",
  "height": 2694,
  "numutxos": 6,
  "balance": 23.3097
```

[07-Jul-19 06:52 AM] jl777c#5810
ok, i will reproduce and fix. such simple logic to have bugs... i need more coffee

{Reactions}
☕ (2) 🍪 (2) 

[07-Jul-19 07:00 AM] rainbro7#4735
James is hilarious. I bet he would have named his pet lizard li777ard 😂 😝

[07-Jul-19 07:03 AM] jl777c#5810
@TonyL fixed the causal issue, which was that the most recent successful getaddressutxos result was being returned

[07-Jul-19 07:03 AM] jl777c#5810
to save time to do spend, i intentionally do not clear the utxos data that is there

[07-Jul-19 07:09 AM] TonyL#3577
```./komodo-cli -ac_name=ILN nspv_listunspent RQ1mvCUcziWzRwE8Ugtex29VjoFjRzxQJT
{
  "result": "error",
  "error": "no utxos result"
}
``` fixed now

[07-Jul-19 07:10 AM] TonyL#3577
and on listunspent without args returning list for address with which I was logined before - really cool

[07-Jul-19 07:15 AM] jl777c#5810
with these rpc calls, we can do a 873 peer saturation test. lilkely being bombarded with requests every second from 873 nodes will cause a lot of load

[07-Jul-19 07:15 AM] jl777c#5810
maybe even some fullnode crashes

[07-Jul-19 07:15 AM] TonyL#3577
sure, will finish unittest and prepare such attack

[07-Jul-19 07:16 AM] jl777c#5810
there really should be more fullnode crashes, i did add a bunch of new p2p messages right into the core

[07-Jul-19 07:16 AM] jl777c#5810
doing mallocs and frees, pointers, all the really dangerous things

[07-Jul-19 07:17 AM] jl777c#5810
one specific test to run is if there is a normal fullnode that is happy and you run it as an nSPV=1 node for a bit, does that mess up any data for the fullnode

[07-Jul-19 07:17 AM] jl777c#5810
i tried to disable all HDD operations, but i still see it is making mods, not sure if it is damaging or not

[07-Jul-19 07:20 AM] TonyL#3577
```./komodo-cli -ac_name=ILN nspv_txproof 67ffe0eaecd6081de04675c492a59090b573ee78955c4e8a85b8ac0be0e8e418 2673
got txproof response 1562483884 size.1820
{
  "txid": "67ffe0eaecd6081de04675c492a59090b573ee78955c4e8a85b8ac0be0e8e418",
  "height": 2673,
  "txlen": 221,
  "txprooflen": 1558
}
``` is it expected that txproof returns proof len but not proof itself?

[07-Jul-19 07:42 AM] jl777c#5810
it is just not being displayed. if you need the hex of the proof, i can add it, bit it seems something only the validation code needs

[07-Jul-19 07:42 AM] jl777c#5810
txlen is also there without rawtx bytes for same reason

[07-Jul-19 07:44 AM] jl777c#5810
i cant fully validate the proof without the merkleroot, but i can calculate a result from the merkle validation and will be adding such useful things to the json

[07-Jul-19 07:52 AM] TonyL#3577
Not sure if proof itself is needed, just wanted to confirm :)

Is retcode 0 means error on broadcast?
` "retcode": 0,` 
have problems with consistent tx broadcasting on ILN, getting such response:
 `got broadcast response 1562485805 size.37 9f3441c0e96d57c742a1137273b89ca6845e5baf0810d2a02dfbd49413e1852d retcode.0` 
not sure what is the problem - I have balance/utxos

[07-Jul-19 07:52 AM] TonyL#3577
maybe it's some specifics because ILN ondemand chain

